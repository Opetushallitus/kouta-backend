sudo: required
language: scala
jdk:
- oraclejdk8
services:
- docker

env:
  global:
  # AWS_ACCESS_KEY_ID
  - secure:
  # AWS_SECRET_ACCESS_KEY
  - secure:

install:
- git clone https://github.com/Opetushallitus/ci-tools.git
- source ci-tools/common/setup-tools.sh

script:
- mvn install

- mv target/kouta-backend-*.jar $DOCKER_BUILD_DIR/artifact/kouta-backend.jar
- cp -vr oph-configuration $DOCKER_BUILD_DIR/config/

- export BASE_IMAGE="base-legacy:0.1"
- ./ci-tools/common/pull-image.sh
- ./ci-tools/build/build-fatjar.sh kouta-backend

deploy:
  provider: script
  script: ./ci-tools/build/upload-image.sh kouta-backend
  on:
    all_branches: true